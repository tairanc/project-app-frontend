(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{ipCV:function(e,t,n){},scvn:function(e,t,n){"use strict";(function(e){var a,o,c,s=p(n("Zx67")),l=p(n("kiBT")),u=p(n("OvRC")),i=p(n("pFYg")),r=p(n("C4MV"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,r.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),f=n("U7vG"),m=E(f),g=(E(n("O27J")),n("Zfgq")),h=n("d2xe"),_=E(n("fw66")),y=n("f2t5"),v=n("2uFj");function E(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,u.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(l.default?(0,l.default)(e,t):e.__proto__=t)}n("ipCV");var w=function(e){function t(){return b(this,t),k(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments))}return M(t,f.Component),d(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.className,a=e.link;return"link"===t?m.default.createElement(g.Link,{to:a,className:n},this.props.children):m.default.createElement("a",{href:a,className:n},this.props.children)}}]),t}(),N=(o=a=function(e){function t(e){b(this,t);var n=k(this,(t.__proto__||(0,s.default)(t)).call(this,e));c.call(n);return n.state={countData:[],couponData:[],update:!1,listUpdate:!1,type:1,hasMore:!0,sending:!1,page:2},n}return M(t,f.Component),d(t,[{key:"componentDidMount",value:function(){this.getMsg(1)}},{key:"componentWillMount",value:function(){document.title="优惠券",window.location.href="jsbridge://set_title?title=优惠券"}},{key:"render",value:function(){var e=this.state,t=e.countData,n=e.type,a=e.couponData,o=e.hasMore,c=e.sending;return this.state.update?m.default.createElement("div",{"data-page":"coupon-list"},m.default.createElement("section",{id:"coupon-list",ref:"coupon"},m.default.createElement(x,{data:t,fn:this.getMsg,changePage:this.changePage}),this.state.listUpdate?m.default.createElement(C,{fn:this.addMsg,data:a,type:n,hasMore:o,sending:c}):m.default.createElement(h.LoadingRound,null))):m.default.createElement(h.LoadingRound,null)}}]),t}(),a.contextTypes={store:m.default.PropTypes.object,router:m.default.PropTypes.object},c=function(){var t=this;this.getMsg=function(n){var a=t;a.setState({listUpdate:!1}),e.ajax({url:"/originapi/user/coupon/list/get",type:"get",data:{is_valid:n,page_size:10,pages:1},success:function(t){200===t.code&&!0===t.status&&(a.setState({countData:t.data.couponList.count,couponData:t.data.couponList.data,update:!0,listUpdate:!0,type:n,hasMore:parseInt(t.data.pagers.current)<t.data.pagers.total}),e("#coupon-list").css({height:e(window).height()}))},error:function(e){_.default.MsgTip({msg:"服务器繁忙"})}})},this.addMsg=function(n){var a=t,o=a.state.page;a.setState({sending:!0}),e.ajax({url:"/originapi/user/coupon/list/get",type:"get",data:{is_valid:n,page_size:10,pages:o},success:function(e){200===e.code&&!0===e.status?a.setState({couponData:a.state.couponData.concat(e.data.couponList.data),type:n,hasMore:e.data.pagers.current<e.data.pagers.total,sending:!1,page:o+1}):(_.default.MsgTip({msg:"服务器繁忙"}),a.setState({sending:!1}))},error:function(e){_.default.MsgTip({msg:"服务器繁忙"}),a.setState({sending:!1})}})},this.changePage=function(){t.setState({page:2})}},o);t.default=N;var x=function(t){function n(){return b(this,n),k(this,(n.__proto__||(0,s.default)(n)).apply(this,arguments))}return M(n,f.Component),d(n,[{key:"componentDidMount",value:function(){var t=this.props,n=t.fn,a=t.changePage;e(".coupon-nav li").click(function(t){if("active-one"===e(this).attr("class"));else{e(this).addClass("active-one").siblings().removeClass("active-one");var o=parseInt(e(".active-one").attr("id"));n(o),a()}})}},{key:"render",value:function(){var e=this.props.data;return m.default.createElement("ul",{className:"coupon-nav c-c35 c-tc c-fs14"},m.default.createElement("li",{className:"active-one",id:"1"},"未使用(",e.no_use>99?"99+":e.no_use,")"),m.default.createElement("li",{id:"0"},"已使用(",e.used>99?"99+":e.used,")"),m.default.createElement("li",{id:"2"},"已过期(",e.expired>99?"99+":e.expired,")"))}}]),n}(),D=function(t){function n(){return b(this,n),k(this,(n.__proto__||(0,s.default)(n)).apply(this,arguments))}return M(n,f.Component),d(n,[{key:"componentWillMount",value:function(){this.setState({canExchange:!0})}},{key:"componentDidMount",value:function(){e(".exchange input").on("input change",function(t){e(this).val()?e(this).next().css({"background-color":"#e60a30"}):e(this).next().css({"background-color":"#c9c9c9"})});var t=this;e(".exchange button").click(function(n){var a=e(".exchange input").val();""!=a&&t.state.canExchange&&(t.setState({canExchange:!1}),e.ajax({url:"/originapi/user/coupon/code/get",type:"get",data:{exchange_code:a},success:function(n){t.setState({canExchange:!0}),_.default.MsgTip({msg:n.msg}),e(".exchange input").val(""),e(".exchange button").css({"background-color":"#c9c9c9"}),!0===n.status&&setTimeout(function(){history.go(0)},500)},error:function(t){_.default.MsgTip({msg:"服务器繁忙"}),e(".exchange input").val("")}}))})}},{key:"render",value:function(){return m.default.createElement("div",{className:"exchange"},m.default.createElement("input",{type:"text",placeholder:"请输入兑换码"}),m.default.createElement("button",null,"兑换"))}}]),n}(),C=function(t){function n(){return b(this,n),k(this,(n.__proto__||(0,s.default)(n)).apply(this,arguments))}return M(n,f.Component),d(n,[{key:"componentWillUnmount",value:function(){e(window).unbind("scroll.get")}},{key:"componentWillMount",value:function(){e("html,body").css({overflowY:"visible"})}},{key:"componentDidMount",value:function(){var t=parseInt(e(".active-one").attr("id")),n=this;n.setState({type:t}),e(window).bind("scroll.get",function(){e(window).scrollTop()>=e(".list-contrl").height()-e(window).height()&&"下拉加载更多"===e(".more").html()&&n.props.fn(t)})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.type,a=e.hasMore,o=e.sending,c=t.map(function(e,t){return m.default.createElement(S,{data:e,type:n,key:t})});return m.default.createElement("div",{className:"list-contrl"},1==n?m.default.createElement(D,null):"",m.default.createElement("div",{className:"each-list"},t.length?c:m.default.createElement(T,null)),t.length?m.default.createElement("div",{className:"more"},a?o?m.default.createElement("span",{className:"loading"},"加载中..."):"下拉加载更多":2==n?"仅保留90天内的记录":"别拉了，我是有底线的~"):"")}}]),n}(),T=function(e){function t(){return b(this,t),k(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments))}return M(t,f.Component),d(t,[{key:"render",value:function(){return m.default.createElement("div",{className:"no-coupon"},m.default.createElement("img",{src:"./src/img/evaluate/no-coupon.png"}))}}]),t}(),S=function(e){function t(){var e,n,a;b(this,t);for(var o=arguments.length,c=Array(o),l=0;l<o;l++)c[l]=arguments[l];return n=a=k(this,(e=t.__proto__||(0,s.default)(t)).call.apply(e,[this].concat(c))),a.getDate=function(e){var t=new Date(1e3*parseInt(e));return t.getFullYear()+"."+(parseInt(t.getMonth())+1)+"."+t.getDate()},a.noUse=function(){_.default.MsgTip({msg:"还未到使用时间哦"})},a.getPrice=function(e){var t=(e=parseFloat(e)).toString().split(".");return 1==t.length?e=m.default.createElement("span",null,t[0],m.default.createElement("span",{className:"c-fs14"},".00")):t.length>1?e=t[1].length<2?m.default.createElement("span",null,t[0],m.default.createElement("span",{className:"c-fs14"},".",t[1],"0")):m.default.createElement("span",null,t[0],m.default.createElement("span",{className:"c-fs14"},".",t[1])):void 0},k(a,n)}return M(t,f.Component),d(t,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.type,a=y.dateUtil.format(1e3*t.use_start_time,"Y/M/D H:F").slice(2),o=y.dateUtil.format(1e3*t.use_end_time,"Y/M/D H:F").slice(2),c="";return c=0===t.coupon_type?t.shop_name+"适用":1===t.coupon_type?"self"===t.used_shop_type?"all"===t.used_category?"all"===t.used_brand?"指定自营商品适用":"自营商品指定品牌适用":"all"===t.used_brand?"自营商品指定分类适用":"自营商品指定分类、品牌适用":"all"===t.used_category?"all"===t.used_brand?"指定商品适用":"指定品牌适用":"all"===t.used_brand?"指定分类适用":"指定分类、品牌适用":4===t.coupon_type?t.rules.coupon_alias:"all"===t.used_category?"all"===t.used_brand?"全平台（特殊商品除外）":"指定品牌适用":"all"===t.used_brand?"指定分类适用":"指定分类、品牌适用",m.default.createElement("div",{className:"each-coupon c-pr"},m.default.createElement("div",{className:1===n?t.isset_limit_money?"coupon-bg":"coupon-bg coupon-bg2":"coupon-bg coupon-bg3"},m.default.createElement("div",{className:"coupon-left c-fl"},m.default.createElement("h2",{className:1===n?t.isset_limit_money?"c-cdred":"c-cdyellow":"c-c999"},"¥ ",m.default.createElement("span",{className:String(parseInt(t.deduct_money)).length<4?" price-a ":" price-b ",style:{lineHeight:"46px"}},4===t.coupon_type?this.getPrice(t.price):parseInt(t.deduct_money))),m.default.createElement("p",{className:"c-c999"},4===t.coupon_type?"原价"+t.market_price:"满"+(t.limit_money?parseFloat(t.limit_money):"")+"使用")),m.default.createElement("div",{className:t.isset_limit_money?"coupon-right c-fl":"coupon-right c-fl coupon-right2"},m.default.createElement("p",{className:"c-c999"},m.default.createElement("span",{className:"c-fs16 c-c35"},4===t.coupon_type?"免单券":0===t.coupon_type?"店铺券":1===t.coupon_type?"self"===t.used_shop_type?"自营券":"跨店券":"平台券"),"all"===t.used_platform?"":" (限"+t.used_platform+"端使用)"),m.default.createElement("li",{className:"c-c999 c-pr title-txt"},c,m.default.createElement("span",{className:"c-pa disc-dot"})),m.default.createElement("p",{className:"c-fs10 c-c999 c-fs10",style:{lineHeight:"14px",display:"block",paddingTop:"12px"}},a,"至",o))),1===n?t.time_status?m.default.createElement("button",{onClick:this.noUse,className:1===n?t.isset_limit_money?"use-coupon":"use-coupon use-coupon2":"use-coupon use-coupon3"}):m.default.createElement(w,{link:4===t.coupon_type?v.RNDomain+"/item?item_id="+t.item_id:1===t.coupon_type?"/searchResult?coupon_id="+t.coupon_id:"biz"===t.shop_attr?"/searchResult?coupon_id="+t.coupon_id+"&type=biz":"/searchResult?coupon_id="+t.coupon_id,type:"link"},m.default.createElement("button",{className:1===n?t.isset_limit_money?"use-coupon":"use-coupon use-coupon2":"use-coupon use-coupon3"})):"")}}]),t}()}).call(this,n("OOjC"))}}]);
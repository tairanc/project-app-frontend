(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{qUDK:function(e,t,a){"use strict";(function(e){var n=u(a("Zx67")),i=u(a("kiBT")),r=u(a("OvRC")),s=u(a("pFYg")),l=u(a("C4MV")),o=u(a("woOf"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c,d,p,f,m,h,g,v,_=o.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},w=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,l.default)(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),y=a("U7vG"),E=S(y),b=a("Zfgq"),k=(a("O27J"),a("d2xe")),N=S(a("fw66")),T=S(a("qAHI")),C=a("2uFj");function S(e){return e&&e.__esModule?e:{default:e}}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,s.default)(t))&&"function"!=typeof t?e:t}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}a("9fvt");var x={listRate:{url:C.MALLAPI+"/rate/list",method:"get"},likeRate:{url:C.MALLAPI+"/rate/like",method:"post"}},I=(d=c=function(t){function a(e,t){D(this,a);var i=L(this,(a.__proto__||(0,n.default)(a)).call(this,e));i.getInitdata=function(e,t,a){T.default.request(_({},x.listRate,{params:{item_id:e,rate_tag_id:t,page:a,page_size:10}})).then(function(e){var t=e.data,n=t.data.total_pages>a;i.setState({evaluateData:t.data,listData:t.data.rates,update:!0,hasMore:n}),document.title="评价（"+t.data.total+"）",window.location.href="jsbridge://set_title?title=评价（"+t.data.total+"）"}).catch(function(e){console.log(e),N.default.MsgTip({msg:"服务器繁忙"})})},i.getList=function(e,t){var a=i.state,n=a.page,r=a.itemID;"clickTag"===t?i.setState({listData:[],page:1,hasMore:!0,Sending:!1},function(){var t=i.state.page;i.getInitdata(r,e,t)}):i.getInitdata(r,e,n)},i.addList=function(e){i.setState({Sending:!0},function(){var t=i.state,a=t.page,n=t.itemID,r=t.listData;T.default.request(_({},x.listRate,{params:{item_id:n,rate_tag_id:e,page:a+1,page_size:10}})).then(function(e){var t=e.data,n=t.data.total_pages>a,s=r.concat(t.data.rates);i.setState({page:a+1,listData:s,Sending:!1,hasMore:n})}).catch(function(e){N.default.MsgTip({msg:"服务器繁忙"})})})};var r=e.location.query.item_id;return i.state={itemID:r,evaluateData:[],listData:[],page:1,update:!1,hasMore:!0,Sending:!1},i}return M(a,y.Component),w(a,[{key:"componentWillMount",value:function(){this.state.itemID||b.browserHistory.push("/"),this.getList()}},{key:"componentWillUnmount",value:function(){e(window).unbind("scroll")}},{key:"componentDidMount",value:function(){var t=this;e(window).bind("scroll",function(){var a=t.state,n=a.hasMore,i=a.Sending,r=a.update;if(e(this).scrollTop()>e(".list").height()-e(window).height()-30&&!i&&n&&r){var s=e(".active-label").attr("id");t.addList(s)}})}},{key:"render",value:function(){var e=this.state,t=e.evaluateData,a=e.listData,n=e.page,i=e.itemID,r=e.hasMore,s=e.Sending,l=this.props.isLogin;return this.state.update?E.default.createElement("div",{"data-page":"evaluate-list"},E.default.createElement("section",{id:"evaluate-list",ref:"evaluate"},E.default.createElement(P,{dataList:t}),E.default.createElement(z,{isLogin:l,dataList:t,page:n,listData:a,itemID:i,fn:this.getList,addFn:this.addList,hasMore:r,Sending:s}))):E.default.createElement(k.LoadingRound,null)}}]),a}(),c.contextTypes={store:E.default.PropTypes.object,router:E.default.PropTypes.object},d);t.default=I;var P=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.dataList;return E.default.createElement("div",{className:"item-msg"},E.default.createElement("img",{src:e.image,className:"item-img"}),E.default.createElement("p",{className:"item-title c-c666"},e.title),E.default.createElement("span",{className:"item-price c-cdred c-fs14"},E.default.createElement("span",{className:"c-fs10"},"￥"),e.sell_price))}}]),t}(),z=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props,t=e.dataList,a=e.itemID,n=e.listData,i=e.page,r=e.fn,s=e.addFn,l=e.isLogin,o=e.hasMore,u=e.Sending;return E.default.createElement("div",{className:"item-evaluate"},t.total?E.default.createElement(j,{isLogin:l,dataList:t,page:i,listData:n,itemID:a,fn:r,addFn:s,hasMore:o,Sending:u}):E.default.createElement(O,null))}}]),t}(),O=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){return E.default.createElement("div",null,E.default.createElement("img",{src:"/src/img/evaluate/no-item.png",className:"none-img"}))}}]),t}(),j=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props,t=e.dataList,a=(e.itemID,e.listData),n=(e.page,e.isLogin),i=e.hasMore,r=e.Sending,s=this.props,l=s.fn;s.addFn;return E.default.createElement("div",{style:{width:"100%",overflow:"hidden"}},E.default.createElement(A,{dataList:t,fn:l}),E.default.createElement(F,{listData:a,isLogin:n,hasMore:i}),r&&E.default.createElement("div",{style:{textAlign:"center"}},E.default.createElement("img",{src:"src/img/icon/loading/loading-round.gif",alt:""})),!i&&E.default.createElement(k.NoMore,null))}}]),t}(),A=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.dataList,t=this.props.fn;return E.default.createElement("div",{className:"list-header",style:{width:"100%"}},E.default.createElement("div",{className:"stars c-fs14"},E.default.createElement("span",{className:"c-fl c-mr10"},"商品评价"),E.default.createElement("div",{className:"c-fl c-mr20 stars-bg"},E.default.createElement("img",{className:"stars-img",src:"/src/img/evaluate/stars.png",style:{backgroundSize:e.praise_rate+" 100%"}})),E.default.createElement("span",{className:"c-cdred c-fl"},e.praise_rate,"好评")),E.default.createElement(R,{labelArr:e.tags,fn:t}))}}]),t}(),R=function(t){function a(e,t){D(this,a);var i=L(this,(a.__proto__||(0,n.default)(a)).call(this,e));return i.openClose=function(){i.setState({isOpen:!i.state.isOpen})},i.state={isOpen:!1,fn:i.props.fn},i}return M(a,y.Component),w(a,[{key:"componentDidMount",value:function(){e(this.refs.listLabels).height()>71||e(".open-labels").css({display:"none"});var t=this;e(".list-label").click(function(a){if("list-label active-label"===e(this).attr("class"));else{var n=e(this).attr("id");t.state.fn(n,"clickTag"),e(this).css({color:"#fff","background-color":"#f88"}).addClass("active-label").siblings().css({color:"#353535","background-color":"#fff2f5"}).removeClass("active-label")}a.preventDefault()})}},{key:"render",value:function(){var e=this.props.labelArr.map(function(e,t){return E.default.createElement(q,{data:e,key:t})});return E.default.createElement("div",{className:"labels-outter"},E.default.createElement("div",{className:this.state.isOpen?"labels-inner-open":"labels-inner"},E.default.createElement("div",{ref:"listLabels",className:"list-labels"},E.default.createElement(q,{data:{text:"全部",rate_tag_id:""}}),e)),E.default.createElement(U,{openClose:this.openClose}))}}]),a}(),U=(f=p=function(e){function t(e,a){D(this,t);var i=L(this,(t.__proto__||(0,n.default)(t)).call(this,e));return i.changeImg=function(){i.setState({isClose:!i.state.isClose}),i.props.openClose()},i.state={isClose:!0},i}return M(t,y.Component),w(t,[{key:"render",value:function(){return E.default.createElement("div",{onClick:this.changeImg,className:this.state.isClose?"open-labels to-open":"open-labels to-close"})}}]),t}(),p.contextTypes={store:E.default.PropTypes.object,router:E.default.PropTypes.object},f),q=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=!1,t=this.props.data;return"全部"===t.text&&(e=!0),E.default.createElement("button",{className:e?"list-label active-label":"list-label",id:t.rate_tag_id},t.text,t.count?"("+t.count+")":"")}}]),t}(),F=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.isLogin,t=this.props.listData.map(function(t,a){return E.default.createElement(X,{isLogin:e,data:t,key:a})});return E.default.createElement("div",{className:"list c-fs14"},t)}}]),t}(),X=(h=m=function(e){function t(e){D(this,t);var a=L(this,(t.__proto__||(0,n.default)(t)).call(this,e));return a.zanClick=function(){if(a.context.isLogin){var e=a,t=e.props.data,n=e.state,i=n.isThumbsUp,r=n.zanCount;n.isSending||(e.setState({isSending:!0}),i?T.default.request(_({},x.likeRate,{data:{rate_id:t.rate_id,liked:0}})).then(function(t){e.setState({isThumbsUp:!i,zanCount:parseInt(r)-1,isSending:!1})}):T.default.request(_({},x.likeRate,{params:{rate_id:t.rate_id,liked:1}})).then(function(t){e.setState({isThumbsUp:!i,zanCount:parseInt(r)+1,isSending:!1})}))}else window.location.href="trmall://to_login"},a.state={isThumbsUp:a.props.data.liked,zanCount:a.props.data.like_count,isSending:!1},a}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.data,t=this.state.zanCount;return E.default.createElement("div",{className:"one-evaluate",id:e.rate_id},e.amazing?E.default.createElement(W,null):"",E.default.createElement(B,{data:e}),E.default.createElement(J,{data:e}),E.default.createElement("div",{className:"thumbs-up"},E.default.createElement("div",{className:this.state.isThumbsUp?"zan zan-already c-fr c-tc":"zan zan-yet c-fr c-tc",onClick:this.zanClick},t||"点赞")))}}]),t}(),m.contextTypes={store:E.default.PropTypes.object,isLogin:E.default.PropTypes.bool},h),B=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.data;return E.default.createElement("div",null,E.default.createElement("div",{className:"user-msg"},E.default.createElement("div",{className:"user-photo"},E.default.createElement("img",{src:e.head_portrait?e.head_portrait:"/src/img/evaluate/user-img.png"})),!e.anonymous&&E.default.createElement("span",null,e.user_name),e.anonymous&&E.default.createElement("span",null,e.user_name,"[匿名]")),E.default.createElement("div",{className:"date-type"},E.default.createElement("span",null,e.create_time?e.create_time:""),E.default.createElement("span",{className:"c-fs12"},e.sku_text||"")))}}]),t}(),W=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){return E.default.createElement("img",{className:"amazing",src:"src/img/evaluate/amazing.png"})}}]),t}(),J=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.data,t={GOOD:"好评！",NEUTRAL:"中评！",BAD:"差评！"}[e.experience];return E.default.createElement("div",{className:"content-txt",style:{overflowWrap:"break-word",wordBreak:"break-all",wordWrap:"break-word"}},E.default.createElement("p",{className:"c-mb14 c-lh25"},e.content?e.content:t),e.image_list.length?E.default.createElement(Y,{data:e.image_list,rateID:e.rate_id}):"",e.replied?E.default.createElement(G,{data:e.reply_content}):"",e.add?E.default.createElement(H,{data:this.props.data.add}):"")}}]),t}(),Y=(v=g=function(t){function a(e){D(this,a);var t=L(this,(a.__proto__||(0,n.default)(a)).call(this,e));return t.state={openImg:!1,largeImgs:[]},t}return M(a,y.Component),w(a,[{key:"componentDidMount",value:function(){var t=this.props,a=t.data,n=t.rateID;if(e(this.refs.imgs).css({height:"135px"}),a.length>2)new Swiper(".swiper1"+n,{observer:!0,freeMode:!0,slidesPerView:"auto"});var i=null,r=new Swiper(".swiper2"+n,{observer:!0,pagination:".swiper-pagination",initialSlide:0}),s=0,l=0,o=!1,u=0,c=0,d=0,p=0,f=0,m=0,h=0,g=0,v=0;e(".swiper2"+n+" img").on("touchstart",function(t){t.preventDefault(),d=t.touches[0].pageX,2==t.touches.length&&(p=t.touches[1].pageX,f=Math.abs(d-p),h=e(this).width(),e(this).height(),g=e(this).offset().left,v=e(this).offset().top-e(window).scrollTop()),u=d-e(this).offset().left,c=t.touches[0].pageY-(e(this).offset().top-e(window).scrollTop()),clearTimeout(i),l=s,s=(new Date).getTime();var a=e(this),n=a.attr("id");i=setTimeout(function(){s-l>300?(a.css({width:"100%"}),a.parent().parent().parent().parent().css({display:"none"}),r.unlockSwipeToNext(),r.unlockSwipeToPrev(),o=!1):!1===o?(a.css({width:"200%",left:-u+"px",top:0,margin:0}),r.lockSwipeToNext(),r.lockSwipeToPrev(),o=!0):(a.css({width:"100%",top:0,left:0,right:0,bottom:0,margin:"auto"}),r.unlockSwipeToNext(),r.unlockSwipeToPrev(),o=!1)},300);var _=document.getElementById(n),w=function(t){if(t.preventDefault(),1==t.targetTouches.length){var n=t.targetTouches[0];o&&(a.css({margin:0}),_.style.left=n.pageX-u+"px",_.style.top=n.pageY-c+"px"),Math.abs(n.pageX-d)>2&&clearTimeout(i)}else if(2==t.targetTouches.length){clearTimeout(i);var s=t.targetTouches[0],l=t.targetTouches[1];m=Math.abs(s.pageX-l.pageX);var p=h+(m-f),w=e(window).width();(p=(p=p>2*w?2*w:p)<w?w:p)>w?(a.css({margin:0}),o=!0,r.lockSwipeToNext(),r.lockSwipeToPrev()):(o=!1,r.unlockSwipeToNext(),r.unlockSwipeToPrev()),a.css({width:p+"px",left:g-(m-f)/2,top:v-(m-f)/2})}};_.addEventListener("touchmove",w,!1),e(_).on("touchend",function(t){_.removeEventListener("touchmove",w,!1),a.width()==e(window).width()&&a.css({width:"100%",top:0,left:0,right:0,bottom:0,margin:"auto"})})}),e(".swiper1"+n+" img").click(function(){e(this).parent().parent().parent().parent().next().css({display:"block"}).find("img").css({top:0,left:0,right:0,bottom:0,margin:"auto"})})}},{key:"render",value:function(){this.state.openImg;var e=this.props,t=e.data,a=e.rateID,n=this,i=t.map(function(e,t){return E.default.createElement("div",{className:"swiper-slide img-outter",key:t},E.default.createElement("div",{className:"content-img c-fl"},E.default.createElement("img",{onClick:n.changeOpen,src:e})))}),r=this.props.data.map(function(e,t){return E.default.createElement("div",{className:"swiper-slide",key:t},E.default.createElement("div",{style:{width:"100%",height:"100%",overflow:"scroll",position:"raletive"}},E.default.createElement("img",{id:"img"+a+t,style:{width:"100%"},src:e})))});return E.default.createElement("div",{"data-plugin":"swiper",className:"content-imgs c-mb14",ref:"imgs"},E.default.createElement("div",{className:"swiper-container small-imgs swiper1"+a},E.default.createElement("div",{className:"swiper-wrapper"},i)),E.default.createElement("div",{style:{display:"none"},className:"swiper-container large-img swiper2"+a},E.default.createElement("div",{className:"swiper-wrapper"},r),E.default.createElement("div",{className:"swiper-pagination"})))}}]),a}(),g.contextTypes={store:E.default.PropTypes.object,router:E.default.PropTypes.object},v),G=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){return E.default.createElement("div",{className:"content-reply"},E.default.createElement("p",{className:"c-mb14 c-lh25"},"客服回复：",this.props.data))}}]),t}(),H=function(e){function t(){return D(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return M(t,y.Component),w(t,[{key:"render",value:function(){var e=this.props.data.setDate;return E.default.createElement("div",{className:"content-add"},E.default.createElement("p",{className:"c-mb14 c-lh25 c-cdred"},"用户",e,"追评"),E.default.createElement("p",{className:"c-mb14 c-lh25"},this.props.data.addEvaluate),this.props.data.reply?E.default.createElement(G,{data:this.props.data.reply}):"")}}]),t}()}).call(this,a("OOjC"))}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"2id7":function(e,t,a){},Yzof:function(e,t,a){"use strict";(function(e){var r=d(a("mvHQ")),n=d(a("Zx67")),i=d(a("kiBT")),s=d(a("OvRC")),l=d(a("pFYg")),o=d(a("C4MV")),c=d(a("woOf"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,m,f=c.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},p=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),h=a("U7vG"),g=k(h),w=a("d2xe"),y=a("Zfgq"),v=(a("4n+p"),a("0p2n")),b=k(a("mtWM")),E=a("2uFj"),_=a("f2t5"),N=a("qeJi"),D=(a("nztU"),a("f2t5"));function k(e){return e&&e.__esModule?e:{default:e}}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,l.default)(t))&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,l.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}a("2id7");var R={getDrawRecordList:{url:E.MALLAPI+"/draw/getDrawRecordList",method:"get",headers:{"Cache-Control":"no-cache"}},getUserTask:{url:E.MALLAPI+"/draw/getUserTask",method:"get",headers:{"Cache-Control":"no-cache"}},getActivityData:{url:E.MALLAPI+"/draw/getActivityData",method:"get",headers:{"Cache-Control":"no-cache"}},getUserDrawNum:{url:E.MALLAPI+"/draw/getUserDrawNum",method:"get",headers:{"Cache-Control":"no-cache"}},getMyPrizeRecord:{url:E.MALLAPI+"/draw/getMyPrizeRecord",method:"get",headers:{"Cache-Control":"no-cache"}},getDrawResult:{url:E.MALLAPI+"/draw/draw",method:"post",headers:{"Cache-Control":"no-cache"}},shareTask:{url:E.MALLAPI+"/draw/shareTask",method:"post",headers:{"Cache-Control":"no-cache"}}},z=window.location.protocol+"//www.tairanmall.com/wap/activities/tairan110.html",P="trmall://to_login?redirectUri="+encodeURIComponent(window.location.href),S=(m=u=function(t){function a(t){M(this,a);var i=L(this,(a.__proto__||(0,n.default)(a)).call(this,t));return i.backReload=function(){window.addEventListener("popstate",function(e){self.location.reload()},!1);window.history.replaceState({title:"",url:"#"},"","#")},i.getDrawResult=function(t,a){b.default.request(f({},R.getDrawResult,{params:{activity_id:t},timeout:1e4})).then(function(t){var r=t.data;return a.goKinerLottery(function(){switch(e("."+r.data.prize_id)[0].id){case"0":return Math.floor(30*Math.random()+210);case"1":return Math.floor(30*Math.random()+255);case"2":return Math.floor(30*Math.random()+300);case"3":return Math.floor(30*Math.random()+345);case"4":return Math.floor(30*Math.random()+30);case"5":return Math.floor(30*Math.random()+75);case"6":return Math.floor(30*Math.random()+120);case"7":return Math.floor(30*Math.random()+165);default:return}}()),i.setState({drawResult:r.data,userDrawNum:r.data.draw_num,successFlag:!0})}).catch(function(r){console.log(r),i.setState({enableClick:!0}),r.response&&504!=r.response.status?(v.tip.show({msg:r.response.data.message||"服务器繁忙"}),a.stopKinerLottery(a.defNum),i.getDrawData("getUserDrawNum",t),"完成任务可获得额外抽奖机会"===r.response.data.message&&e(window).scrollTop(.6*e(window).height())):i.setState({timeout:!0})})},i.getDrawData=function(e,t,a){var r=i;b.default.request("getDrawRecordList"===e?f({},R.getDrawRecordList,{params:{activity_id:t}}):"getUserDrawNum"===e?f({},R.getUserDrawNum,{params:{activity_id:t}}):"getMyPrizeRecord"===e?f({},R.getMyPrizeRecord,{params:{activity_id:t,page_size:12,page:a}}):"getActivityData"===e?f({},R.getActivityData,{params:{activity_id:t}}):"getUserTask"===e?f({},R.getUserTask,{params:{activity_id:t}}):"shareTask"===e?f({},R.shareTask,{params:{activity_id:t}}):"").then(function(n){var s=n.data;switch(e){case"getDrawRecordList":return i.setState({drawRecordList:s.data.data});case"getUserDrawNum":return i.setState({userDrawNum:s.data});case"getMyPrizeRecord":return i.setState({myPrizeRecord:s.data,prizeList:1===a?s.data.data:r.state.prizeList.concat(s.data.data),isSending:!1});case"getActivityData":return i.setState({activityData:s.data,update:!0});case"getUserTask":return i.setState({userTask:s.data});case"shareTask":return r.getDrawData("getUserDrawNum",t),void r.getDrawData("getUserTask",t);default:return}}).catch(function(e){console.log(e),v.tip.show({msg:e.response.data.message||"服务器繁忙"})})},i.handleRuleModal=function(){i.setState({ruleModal:!i.state.ruleModal})},i.handleCloseWinModal=function(){i.setState({winModal:!i.state.winModal})},i.shareMsg=function(){var e=i,t=i.state.activityData,a=(N.browser.versions.iPhone,i.props.location.query.activity_id),n={title:t.share_title,content:t.share_description,icon:t.share_image,link:D.RHOST+window.location.pathname+window.location.search},s=(0,_.base64encode)((0,_.utf16to8)((0,r.default)(n)));setTimeout(function(){e.getDrawData("shareTask",a)},1e3),window.location.href="trmall://share?params="+s},i.state={update:!1,ruleModal:!1,winModal:!1,drawRecordList:"",userDrawNum:0,myPrizeRecord:"",prizeList:[],activityData:"",userTask:"",drawResult:"",enableClick:!0,leadShare:!1,successFlag:!1,timeout:!1,isSending:!1},i}return C(a,h.Component),p(a,[{key:"componentWillMount",value:function(){var e=this;this.backReload();var t=this.props.location.query.activity_id,a=this;t||y.browserHistory.push("/"),this.getDrawData("getActivityData",t),setTimeout(function(){a.getDrawData("getDrawRecordList",t),r()}),this.getDrawData("getUserDrawNum",t);var r=function(){e.timer=setInterval(function(){e.getDrawData("getDrawRecordList",t)},6e4)}}},{key:"componentDidMount",value:function(){var e=N.browser.versions,t=(e.android,e.iPhone,this.props.location.query.activity_id);this.getDrawData("getMyPrizeRecord",t,1),this.getDrawData("getUserTask",t),window.shareSuccess=function(){},window.onResume=function(){location.reload()},window.onPause=function(){}}},{key:"componentWillUnmount",value:function(){e("body").css({overflow:"",position:""}),this.oneTimer=null}},{key:"render",value:function(){var t=this,a=this.state,r=a.update,n=a.ruleModal,i=a.drawRecordList,s=a.userDrawNum,l=a.myPrizeRecord,o=a.prizeList,c=a.activityData,d=a.userTask,u=a.winModal,m=a.enableClick,f=a.drawResult,p=a.leadShare,h=a.successFlag,y=a.timeout,v=a.isSending,b=this.props.location.query.activity_id,E=this.context;return u||n||p?e("body").css({overflow:"hidden",position:"fixed"}):e("body").css({overflow:"",position:""}),r?g.default.createElement("div",{"data-page":"lucky-draw"},g.default.createElement("div",{className:"top"},g.default.createElement("button",{className:"rule",onClick:this.handleRuleModal}),i&&g.default.createElement(T,{drawRecordList:i}),g.default.createElement("img",{className:"activity_time",src:"/src/img/activity/20181111/activity_time.png"})),g.default.createElement(A,{activityData:c,getDrawData:this.getDrawData,userDrawNum:s,getDrawResult:this.getDrawResult,activity_id:b,enableClick:m,handleEnableClick:function(e){t.setState({enableClick:e})},handleWinModalStatus:this.handleCloseWinModal,successFlag:h,timeout:y,isLogin:E.isLogin}),d&&!(d instanceof Array)&&g.default.createElement(K,{userTask:d,shareMsg:this.shareMsg,isLogin:E.isLogin}),l&&g.default.createElement(U,{myPrizeRecord:l,isLogin:E.isLogin,isSending:v,prizeList:o,getDrawData:this.getDrawData,activity_id:b,handleIsSending:function(e){t.setState({isSending:e})}}),g.default.createElement(H,{closeRuleModal:this.handleRuleModal,ruleModal:n,activityData:c}),g.default.createElement(I,{winModal:u,handleWinModalStatus:this.handleCloseWinModal,drawResult:f}),g.default.createElement("a",{className:"dobber-button",href:z})):g.default.createElement(w.LoadingRound,null)}}]),a}(),u.contextTypes={isApp:g.default.PropTypes.bool,isLogin:g.default.PropTypes.bool},m);t.default=S;var T=function(e){function t(){var e,a,r;M(this,t);for(var i=arguments.length,s=Array(i),l=0;l<i;l++)s[l]=arguments[l];return a=r=L(this,(e=t.__proto__||(0,n.default)(t)).call.apply(e,[this].concat(s))),r.getHtml=function(e){return e.map(function(e,t){return g.default.createElement("div",{className:"swiper-slide each-one",key:t},"恭喜 ",e.tel,"    抽中了",e.prize_alias)})},L(r,a)}return C(t,h.Component),p(t,[{key:"componentDidMount",value:function(){this.swiper=new Swiper(this.refs.swiperWinningRadio,{loop:!0,autoplay:{delay:0},autoplayDisableOnInteraction:!1,slidesPerView:1.3,loopedSlides:10,speed:3e3})}},{key:"render",value:function(){var e=this.props.drawRecordList;return e&&e.length?g.default.createElement("div",{className:"winning-radio","data-plugin":"swiper"},g.default.createElement("img",{className:"ring",src:"/src/img/activity/20181111/trumpet.png"}),g.default.createElement("div",{className:"swiper-container",ref:"swiperWinningRadio"},g.default.createElement("div",{className:"swiper-wrapper"},this.getHtml(e)))):g.default.createElement("div",{className:"winning-radio"},g.default.createElement("img",{className:"ring",src:"/src/img/activity/20181111/trumpet.png"}))}}]),t}(),A=function(t){function a(){return M(this,a),L(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return C(a,h.Component),p(a,[{key:"componentDidMount",value:function(){var e=this;this.KinerLottery=new KinerLottery({rotateNum:5,body:".draw",direction:0,disabledHandler:function(e){switch(e){case"noStart":window.location.replace(P);break;case"completed":alert("活动已结束")}},clickCallback:function(){if(e.props.enableClick&&(e.props.handleEnableClick(!1),e.props.getDrawResult(e.props.activity_id,this),e.props.userDrawNum)){this.goKinerLottery(Math.floor(30*Math.random()+210))}},KinerLotteryHandler:function(t){e.props.successFlag?(e.props.handleEnableClick(!0),e.props.handleWinModalStatus(),e.props.getDrawData("getMyPrizeRecord",e.props.activity_id,1)):e.props.timeout&&(v.tip.show({msg:"您的网络丢了，我帮您重新刷一下"}),setTimeout(function(){location.reload()},2e3))}})}},{key:"render",value:function(){var t=this.props,a=t.activityData,r=t.isLogin,n=t.userDrawNum,i=a.prize_list&&a.prize_list.map(function(t,a){var r=Math.sin(45*Math.PI/180*(a+1))*e(window).width()*54/100/2+.79*e(window).width()/2,n=Math.cos(45*Math.PI/180*(a+1))*e(window).width()*54/100/2+.765*e(window).width()/2;return g.default.createElement("div",{className:"each-prize  each-prize"+a+" "+t.id,id:a,key:a,style:{left:r,top:n}},g.default.createElement("div",{className:"img-wraper"},g.default.createElement("img",{className:"prize-img",src:t.prize_image})))});return g.default.createElement("div",{className:"draw-area"},g.default.createElement("img",{src:"/src/img/activity/20181111/marquee.gif",className:"marquee-bg"}),g.default.createElement("img",{src:"/src/img/activity/20181111/ball.jpg",className:"ball1"}),g.default.createElement("img",{src:"/src/img/activity/20181111/ball.jpg",className:"ball2"}),g.default.createElement("div",{className:"draw"},g.default.createElement("div",{className:"draw-turntable outer KinerLottery KinerLotteryContent",style:{position:"relative"}},i,g.default.createElement("img",{src:"/src/img/activity/20181111/turntable.png",className:"draw-bg"})),g.default.createElement("img",{className:"draw-button inner KinerLotteryBtn "+(r?"start":"no-start"),src:r?"/src/img/activity/20181111/draw_click.png":"/src/img/activity/20181111/login_button.png"}),r?g.default.createElement("div",{className:"tip c-fs12 c-cfff c-tc"},"今天还有",g.default.createElement("span",{className:"c-cfe8 c-fs15"}," ",n," "),"次机会"):g.default.createElement("div",{className:"tip c-fs13 c-cfff c-tc"},"登录后可查看抽奖机会")),g.default.createElement("div",{className:"draw-bottom"},g.default.createElement("img",{src:"/src/img/activity/20181111/turntable_bottom.png"})))}}]),a}(),K=function(e){function t(){return M(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return C(t,h.Component),p(t,[{key:"render",value:function(){var e=this.props,t=e.userTask,a=e.shareMsg,r=e.isLogin;N.browser.versions.android;return g.default.createElement("div",{className:"task-area"},g.default.createElement("div",{className:"title c-fs14 c-cfff c-tc"},"做任务可获得额外抽奖机会"),t&&g.default.createElement("ul",{className:"task-list"},!!t.share.reward_times&&g.default.createElement("li",null,g.default.createElement("img",{className:"c-fl",src:"/src/img/activity/20181111/icon_share.png"}),g.default.createElement("div",{className:"c-dpib content"},g.default.createElement("p",{className:"c-fb"},"分享活动",t.share.finished&&g.default.createElement("img",{className:"finished c-ml5",src:"/src/img/activity/20181111/done.png"})),g.default.createElement("span",null,"每天分享该活动可抽奖",t.share.reward_times,"次")),g.default.createElement("button",{className:"share-button",onClick:r?a:function(){location.href=P}},"去分享")),!!t.shop_cart.reward_times&&g.default.createElement("li",null,g.default.createElement("img",{className:"c-fl",src:"/src/img/activity/20181111/icon_cart.png"}),g.default.createElement("div",{className:"c-dpib content"},g.default.createElement("p",{className:"c-fb"},"加入购物袋",t.shop_cart.finished&&g.default.createElement("img",{className:"finished c-ml5",src:"/src/img/activity/20181111/done.png"})),g.default.createElement("span",null,"将商品加入购物袋可获得",t.shop_cart.reward_times,"次")),g.default.createElement("a",{className:"share-button",href:r?z:P},"去逛逛")),!!t.payment.reward_times&&g.default.createElement("li",null,g.default.createElement("img",{className:"c-fl",src:"/src/img/activity/20181111/icon_order.png"}),g.default.createElement("div",{className:"c-dpib content"},g.default.createElement("p",{className:"c-fb"},"购物订单",t.payment.finished&&g.default.createElement("img",{className:"finished c-ml5",src:"/src/img/activity/20181111/done.png"})),g.default.createElement("span",null,"支付完成一笔订单可获得",t.payment.reward_times,"次")),g.default.createElement("a",{className:"share-button",href:r?z:P},"去逛逛")),!!t.rate.reward_times&&g.default.createElement("li",null,g.default.createElement("img",{className:"c-fl",src:"/src/img/activity/20181111/icon_evaluate.png"}),g.default.createElement("div",{className:"c-dpib content"},g.default.createElement("p",{className:"c-fb"},"晒图评价",t.rate.finished&&g.default.createElement("img",{className:"finished c-ml5",src:"/src/img/activity/20181111/done.png"})),g.default.createElement("span",null,"评价订单并晒图可获得",t.rate.reward_times,"次")),g.default.createElement("a",{className:"share-button",href:r?"trmall://myOrder?type=0&registLifecircle=true":P},"去晒图"))))}}]),t}(),U=function(t){function a(){return M(this,a),L(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return C(a,h.Component),p(a,[{key:"componentDidMount",value:function(){var t=this,a=this.props.activity_id;e(".myPrize-record-wrapper").bind("scroll.loadmore",function(){var r=t.props.myPrizeRecord.page,n=(r.total_page,r.current_page);e(this).scrollTop()>e(".myPrize-record ul").height()-e(".myPrize-record-wrapper").height()&&"下拉加载更多"===e(".add span").html()&&(t.props.handleIsSending(!0),t.props.getDrawData("getMyPrizeRecord",a,+n+1))})}},{key:"render",value:function(){var e=this.props,t=e.myPrizeRecord,a=e.isLogin,r=e.isSending,n=e.prizeList,i=t.page,s=i.total_page,l=i.current_page;return g.default.createElement("div",{className:"my-prize"},g.default.createElement("div",{className:"title c-fs14 c-cfff c-tc"},"我的奖品"),g.default.createElement("div",{className:"myPrize-record"},g.default.createElement("div",{className:"myPrize-record-wrapper"},g.default.createElement("ul",{className:"c-clrfix"},a?n.length?n.map(function(e,t){return g.default.createElement("li",{className:"",key:t,style:t%2==1?{float:"right"}:{float:"left"}},g.default.createElement("div",{className:"c-tc prize-detail"},g.default.createElement("span",{className:"c-fb gift_title"},e.prize_alias),g.default.createElement("br",null),("0"===e.prize_type||"1"===e.prize_type||"2"===e.prize_type)&&g.default.createElement("span",null,g.default.createElement("span",{className:"sub_title"},e.arguments.use_condition),g.default.createElement("br",null)),g.default.createElement("span",{className:"c-fs10 c-c35"},e.created_at.substr(5))))}):g.default.createElement("div",{className:"no-prize"},g.default.createElement("img",{src:"/src/img/activity/20181111/no_prize.png"}),g.default.createElement("span",{className:"c-fs14 c-cc9 no-prize-tip"},"您还没有获得奖品哦")):g.default.createElement("div",{className:"no-prize"},g.default.createElement("a",{href:P,className:"button"},"登录查看"),g.default.createElement("span",{className:"c-fs14 c-cc9 no-prize-tip c-tc"},"登录后可以查看您的奖品哦"))),a&&!!n.length&&g.default.createElement("div",{className:"add"},l!=s?r?g.default.createElement("span",{className:"loading"},"加载中..."):g.default.createElement("span",{style:{height:"30px",lineHeight:"50px"}},"下拉加载更多"):null))))}}]),a}(),H=function(e){function t(){return M(this,t),L(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return C(t,h.Component),p(t,[{key:"render",value:function(){var e=this.props,t=e.ruleModal,a=e.closeRuleModal,r=e.activityData;return t?g.default.createElement("div",{className:"rule"},g.default.createElement(w.Shady,{clickHandle:a}),g.default.createElement("div",{className:"rule-modal"},g.default.createElement("div",null,g.default.createElement("div",{className:"rule-content",dangerouslySetInnerHTML:{__html:r.activity_rule}}),g.default.createElement("button",{className:"sure-button",onClick:a})),g.default.createElement("button",{className:"close",onClick:a},g.default.createElement("img",{src:"/src/img/activity/20181111/close-button.png"})))):null}}]),t}(),I=function(t){function a(){return M(this,a),L(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return C(a,h.Component),p(a,[{key:"render",value:function(){var t=this.props,a=t.winModal,r=t.handleWinModalStatus,n=t.drawResult;N.browser.versions.android;return a?g.default.createElement("div",{className:"win"},g.default.createElement(w.Shady,null),g.default.createElement("div",{className:" modal-bg"},"0"===e("."+n.prize_id)[0].id?g.default.createElement("div",{className:"losing-lottery"},g.default.createElement("a",{className:"button button-center",href:z})):g.default.createElement("div",{className:"win-modal"},g.default.createElement("div",{className:"content"},g.default.createElement("img",{src:n.prize_image})),g.default.createElement("p",{className:"title"},n.prize_alias),g.default.createElement("a",{className:"button button-left",href:z}," "),g.default.createElement("a",{className:"button button-right",href:"trmall://getCouponBag?registLifecircle=true&type="+("3"===n.type?"redPacket":"coupon")}," ")),g.default.createElement("button",{className:"close",onClick:r},g.default.createElement("img",{src:"/src/img/activity/20181111/close-button.png"})))):null}}]),a}()}).call(this,a("OOjC"))},mJVD:function(e,t,a){"use strict";(function(e){!function(e,t,a){var r={rotateNum:5,body:"",disabledHandler:function(){},clickCallback:function(){},KinerLotteryHandler:function(e){}};function n(e){this.opts=a.extend(!0,{},r,e),this.doing=!1,this.init()}n.prototype.setOpts=function(e){this.opts=a.extend(!0,{},r,e),this.init()},n.prototype.init=function(){var e=this;this.defNum=360*this.opts.rotateNum,a(".KinerLotteryBtn").on("click",function(){if(a(this).hasClass("start")&&!e.doing)e.opts.clickCallback.call(e);else{var t=a(this).hasClass("no-start")?"noStart":a(this).hasClass("completed")?"completed":"illegal";e.opts.disabledHandler(t)}}),a(this.opts.body).find(".KinerLotteryContent").get(0).addEventListener("webkitTransitionEnd",function(){e.doing=!1;var t=a(e.opts.body).attr("data-deg");0==e.opts.direction?(a(e.opts.body).attr("data-deg",360-t),a(e.opts.body).find(".KinerLotteryContent").css({"-webkit-transition":"none",transition:"none","-webkit-transform":"rotate("+t+"deg)",transform:"rotate("+t+"deg)"}),e.opts.KinerLotteryHandler(360-t)):(a(e.opts.body).attr("data-deg",t),a(e.opts.body).find(".KinerLotteryContent").css({"-webkit-transition":"none",transition:"none","-webkit-transform":"rotate("+-t+"deg)",transform:"rotate("+-t+"deg)"}),e.opts.KinerLotteryHandler(t))})},n.prototype.goKinerLottery=function(e){var t=e+this.defNum,r=0==this.opts.direction?t:-t;this.doing=!0,a(this.opts.body).find(".KinerLotteryBtn").addClass("doing"),a(this.opts.body).find(".KinerLotteryContent").css({"-webkit-transition":"all 5s",transition:"all 5s","-webkit-transform":"rotate("+r+"deg)",transform:"rotate("+r+"deg)"}),a(this.opts.body).attr("data-deg",e)},n.prototype.stopKinerLottery=function(e){var t=e+this.defNum,r=0==this.opts.direction?t:-t;this.doing=!1,a(this.opts.body).find(".KinerLotteryBtn").addClass("doing"),a(this.opts.body).find(".KinerLotteryContent").css({"-webkit-transition":"all 0s",transition:"all 0s","-webkit-transform":"rotate("+r+"deg)",transform:"rotate("+r+"deg)"}),a(this.opts.body).attr("data-deg",e)},e.KinerLottery=n}(window,document,e)}).call(this,a("OOjC"))}}]);
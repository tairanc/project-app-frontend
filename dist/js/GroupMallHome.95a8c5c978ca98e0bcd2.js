(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"/uVr":function(e,t,n){},VdCv:function(e,t,n){"use strict";(function(e){var a=c(n("Zx67")),i=c(n("kiBT")),o=c(n("OvRC")),r=c(n("pFYg")),s=c(n("C4MV")),l=c(n("woOf"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.NoMoreItem=void 0;var u,p,d,m,f=l.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},g=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,s.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),h=n("U7vG"),v=L(h),w=n("4n+p"),y=n("d2xe"),_=(n("Zfgq"),n("f2Hk")),k=n("zpSi"),E=L(n("mtWM")),b=L(n("fw66"));n("qeJi");n("/uVr");var N=n("2uFj");function L(e){return e&&e.__esModule?e:{default:e}}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,r.default)(t))&&"function"!=typeof t?e:t}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,r.default)(t)));e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}var D={nav:{url:"/newapi/promotion/groupBuy/category",method:"get"},list:{url:"/newapi/promotion/groupBuy/item",method:"get"},banner:{url:"/newapi/promotion/groupBuy/getGroupBanner",method:"get"},comingList:{url:"/newapi/promotion/groupBuy/comingItem",method:"get"},collection:{url:"/newapi/user/collection/add",method:"post"},cancelcollection:{url:"/newapi/user/collection/remove",method:"get"}},A=(0,_.actionAxios)("groupMallHome"),x=(0,_.actionAxiosAll)("groupMallHome"),I=(0,_.concatPageAndType)("groupMallHome"),B=E.default.CancelToken,H=void 0,S=v.default.createElement(y.EmptyPageLink,{config:{bgImgUrl:"/src/img/activity/item-none-page.png",msg:"暂时没有活动商品",btnText:"返回",btnClick:function(){location.href="jsbridge://goBack"}}}),O=v.default.createElement(y.EmptyPageLink,{config:{bgImgUrl:"/src/img/activity/item-none-page.png",msg:"暂时没有预告商品",btnText:"返回",btnClick:function(){location.href="jsbridge://goBack"}}}),j=(p=u=function(t){function n(t,i){C(this,n);var o=T(this,(n.__proto__||(0,a.default)(n)).call(this,t));return o.dropDown=function(e){var t=o.props,n=t.list,a=t.categoryId,i=t.dispatch;if(n.page>=n.total)return e.lock(),e.noData(),void e.resetload();n.isComing?E.default.request(f({},D.comingList,{cancelToken:new B(function(e){H=e}),params:{category_id:a,page:n.page+1,limit:20}})).then(function(t){if(!t.data.status)return b.default.MsgTip({msg:t.data.msg}),void e.resetload();i(I("concatDataSuccess",{result:t.data})),e.resetload()}):E.default.request(f({},D.list,{cancelToken:new B(function(e){H=e}),params:{category_id:a,page:n.page+1,limit:20}})).then(function(t){if(!t.data.status)return b.default.MsgTip({msg:t.data.msg}),void e.resetload();i(I("concatDataSuccess",{result:t.data})),e.resetload()})},document.title="拼团",i.isApp&&(location.href="jsbridge://set_title?title=拼团"),o.reload=e('<meta name="reload-enbaled" content="false" />'),e("head").append(o.reload),o}return M(n,h.Component),g(n,[{key:"componentWillMount",value:function(){this.props.load&&this.props.getNav()}},{key:"componentDidMount",value:function(){echo.init({offset:0,throttle:0})}},{key:"componentDidUpdate",value:function(){echo.init({offset:0,throttle:0})}},{key:"componentWillUnmount",value:function(){this.props.saveDistanceTop(),this.reload.remove()}},{key:"render",value:function(){return this.props.load?v.default.createElement(y.LoadingRound,null):v.default.createElement("div",{"data-page":"group-mall-home",style:{minHeight:e(window).height(),background:"#f4f4f4"}},v.default.createElement("div",{className:"home-index"},v.default.createElement(P,{data:this.props.nav,getList:this.props.getList,changeList:this.props.changeList,categoryId:this.props.categoryId}),this.props.banner&&this.props.showBanner?v.default.createElement(R,{data:this.props.banner}):"",this.props.listLoad?v.default.createElement(y.LoadingRound,null):this.props.list.data?v.default.createElement(U,{data:this.props.list.data,isComing:this.props.list.isComing,dropDown:this.dropDown,isApp:this.context.isApp,isLogin:this.context.isLogin}):this.props.list.isComing?O:S,v.default.createElement(G,null)))}}]),n}(),u.contextTypes={isApp:v.default.PropTypes.bool,isLogin:v.default.PropTypes.bool},p),P=function(e){function t(){return C(this,t),T(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return M(t,h.Component),g(t,[{key:"componentDidMount",value:function(){var e=new Swiper(this.refs.swiperNav,{slidesPerView:"auto",paginationClickable:!0,freeMode:!0,onTap:function(){e.clickedIndex>=1&&e.slideTo(e.clickedIndex-2)}});this.props.getList()}},{key:"getNavList",value:function(){var e=this;return this.props.data&&this.props.data.map(function(t,n){var a=e.props.data.length;return v.default.createElement("div",{className:"swiper-slide "+(e.props.categoryId===t.category_id?"active":""),key:n,onClick:n===a-1?function(n){return e.props.changeList(t.category_id,!0)}:function(n){return e.props.changeList(t.category_id)}},v.default.createElement("span",null,t.name))})}},{key:"render",value:function(){return v.default.createElement("div",{"data-plugin":"swiper",className:"home-nav"},v.default.createElement("div",{className:"swiper-container",ref:"swiperNav"},v.default.createElement("div",{className:"swiper-wrapper"},this.getNavList())))}}]),t}(),R=function(e){function t(){return C(this,t),T(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return M(t,h.Component),g(t,[{key:"componentDidMount",value:function(){this.props.data.length>1&&(this.swiper=new Swiper(this.refs.swiperBanner,{autoplay:3e3,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination",paginationType:"fraction",loop:!0}))}},{key:"getHtml",value:function(){return this.props.data&&this.props.data.map(function(e,t){return v.default.createElement("a",{className:"swiper-slide",href:e.link_target||"javascript:void(0)",key:t},v.default.createElement("img",{src:e.img_link}))})}},{key:"render",value:function(){var e=void 0;return e=this.props.data.length>1?{display:"block"}:{display:"none"},v.default.createElement("div",{"data-plugin":"swiper",className:"home-banner"},v.default.createElement("div",{className:"swiper-container",ref:"swiperBanner"},v.default.createElement("div",{className:"swiper-wrapper"},this.getHtml()),v.default.createElement("div",{className:"swiper-pagination",style:e})))}}]),t}(),U=function(e){function t(){return C(this,t),T(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return M(t,h.Component),g(t,[{key:"render",value:function(){return v.default.createElement("div",{className:"group-list",id:"groupList"},v.default.createElement(V,{data:this.props.data,scrollArea:window,isComing:this.props.isComing,dropDown:this.props.dropDown,isApp:this.props.isApp,isLogin:this.props.isLogin}))}}]),t}(),q=function(e){function t(){return C(this,t),T(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return M(t,h.Component),g(t,[{key:"render",value:function(){var e=this;return v.default.createElement("div",{className:"group-body"},this.props.data&&this.props.data.map(function(t,n){return v.default.createElement(W,{data:t,key:n,isComing:e.props.isComing,isApp:e.props.isApp,isLogin:e.props.isLogin})}))}}]),t}(),V=(0,k.DropDownLoad)(q),W=(d=function(e){function t(e){C(this,t);var n=T(this,(t.__proto__||(0,a.default)(t)).call(this,e));m.call(n);var i=n.props,o=i.data,r=i.isLogin;return n.state={is_fav:!!r&&o.is_fav,clickAble:!0},n}return M(t,h.Component),g(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,a=t.isComing,i=this.state,o=i.is_fav,r=i.clickAble;n.item_id;return v.default.createElement("div",{className:"group-item"},v.default.createElement("a",{className:"item-img",href:N.RNDomain+"/item?item_id="+n.item_id},"ROOKIE_GROUP"===n.group_type?v.default.createElement("img",{className:"new-group",src:"/src/img/activity/new-group.png"}):"",v.default.createElement("img",{"data-echo":n.primary_image+"_m.jpg",src:"/src/img/icon/loading/default-watermark.png"}),n.store?"":v.default.createElement("div",{className:"sale-out"},"已抢完")),v.default.createElement("a",{className:"item-title",href:N.RNDomain+"/item?item_id="+n.item_id},n.title),v.default.createElement("div",{className:"item-info"},v.default.createElement("div",{className:"item-text"},v.default.createElement("i",{className:"people-black-icon"}," "),v.default.createElement("span",null,n.group_persons,"人团"),v.default.createElement("div",{className:"price"},v.default.createElement("span",null,"¥"),+n.group_price),n.price?v.default.createElement("del",{className:"market-price"},"单买价¥",+n.price):""),a?v.default.createElement("button",{className:"item-btn blue-btn "+(o?"collection":""),onClick:function(){r&&e.goCollection()}},o?"已收藏":"抢先收藏"):v.default.createElement("a",{className:"item-btn",href:N.RNDomain+"/item?item_id="+n.item_id},n.store?"去开团":"去看看"," ",v.default.createElement("i",{className:"arrow-right-white-icon"}," "))))}}]),t}(),m=function(){var e=this;this.goCollection=function(){var t=e,n=t.props,a=n.data,i=n.isLogin,o=t.state.is_fav;t.setState({clickAble:!1},function(){i?o?E.default.request(f({},D.cancelcollection,{params:{item_id:a.item_id}})).then(function(e){e.data.success?b.default.MsgTip({msg:e.data.msg}):(b.default.MsgTip({msg:e.data.msg}),t.setState({is_fav:!1,clickAble:!0}))}):E.default.request(f({},D.collection,{params:{item_id:a.item_id}})).then(function(e){e.data.success?b.default.MsgTip({msg:e.data.msg}):(b.default.MsgTip({msg:e.data.msg}),t.setState({is_fav:!0,clickAble:!0}))}):window.location.href="trmall://to_login"})}},d),G=function(t){function n(t){C(this,n);var i=T(this,(n.__proto__||(0,a.default)(n)).call(this,t));return i.clickHandle=function(){e(window).scrollTop(0)},i.state={show:!1},i}return M(n,h.Component),g(n,[{key:"componentWillMount",value:function(){var t=this;this.showHandle=function(){e(window).scrollTop()<=2*e(window).height()?t.setState({show:!1}):t.setState({show:!0})},window.addEventListener("scroll",this.showHandle)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.showHandle)}},{key:"render",value:function(){return v.default.createElement("div",null,this.state.show&&v.default.createElement("div",{className:"return-top",onClick:this.clickHandle},v.default.createElement("img",{src:"/src/img/home/return-top.png",width:"100%",height:"100%"})))}}]),n}();t.NoMoreItem=function(){return v.default.createElement("div",{style:{fontSize:"13px",padding:"25px 0",textAlign:"center"}},"别拉了，我是有底线的~")};t.default=(0,w.connect)(function(e,t){return f({},e.groupMallHome)},function(t,n){return{dispatch:t,getNav:function(){t(x("init",[f({},D.nav),f({},D.banner)]))},getList:function(e){t(A("getList",f({},D.list,{params:{category_id:e,page:1,limit:20}})))},saveDistanceTop:function(){t(I("saveTop",{value:e(window).scrollTop()}))}}},function(e,t,n){e.categoryId;var a=t.dispatch;return f({},e,t,n,{changeList:function(e,t){a(I("hideBanner",""!==e?{showBanner:!1}:{showBanner:!0})),H&&H("cancel Success"),a(I("changeId",{id:e})),a(A("getList",t?f({},D.comingList,{cancelToken:new B(function(e){H=e}),params:{page:1,limit:20}}):f({},D.list,{cancelToken:new B(function(e){H=e}),params:{category_id:e,page:1,limit:20}})))}})})(j)}).call(this,n("OOjC"))}}]);